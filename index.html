<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Yeni YÄ±l KutlamasÄ± â€” Final SÃ¼rÃ¼m</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        background: linear-gradient(#001, #034);
        color: white;
        font-family: Arial;
        user-select: none;
    }

    .panel {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        z-index: 50;
    }

    .footer {
        position: fixed;
        bottom: 10px;
        width: 100%;
        text-align: center;
        color: #ccc;
        font-size: 14px;
        z-index: 50;
    }
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div class="panel">
    <button id="soundBtn">ðŸ”‡ Ses KapalÄ±</button>
    <button id="startBtn">ðŸŽ† KutlamayÄ± BaÅŸlat</button>
</div>

<div class="footer">Bu sayfa: Kemalettin Duyar tarafÄ±ndan yapÄ±lmÄ±ÅŸtÄ±r.</div>

<!-- Gizli versiyon kontrol -->
<div id="ver" style="display:none">v4.0.1</div>

<script>
/* =============== CANVAS AYARLARI =============== */
const canvas = document.getElementById("canvas");
const c = canvas.getContext("2d");
function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
resize();
window.onresize = resize;

/* =============== KAR YAÄžIÅžI =============== */
let snowflakes = [];
for (let i = 0; i < 200; i++) {
    snowflakes.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        r: Math.random() * 3 + 1,
        s: Math.random() * 1 + 0.5
    });
}

/* =============== HAVAÄ° FÄ°ÅžEKLER =============== */
let fireworks = [];

function spawnFirework() {
    let x = Math.random() * canvas.width;
    let y = canvas.height + 20;
    let tx = x;
    let ty = Math.random() * (canvas.height / 2);

    fireworks.push({
        x, y, tx, ty,
        particles: [],
        exploded: false
    });
}

/* =============== SES MOTORU =============== */
let ctx = null;
let globalMusicGain = null;
let soundEnabled = false;

function initAudio() {
    if (!ctx) {
        ctx = new (window.AudioContext || window.webkitAudioContext)();

        /* Hafif yÄ±lbaÅŸÄ± mÃ¼ziÄŸi â€” sÃ¼rekli ambient */
        const osc1 = ctx.createOscillator();
        const osc2 = ctx.createOscillator();
        const gain1 = ctx.createGain();
        const gain2 = ctx.createGain();
        globalMusicGain = ctx.createGain();

        osc1.type = "sine"; 
        osc1.frequency.value = 320;   // temel nota
        gain1.gain.value = 0.08;

        osc2.type = "triangle";
        osc2.frequency.value = 480;  // Ã¼st armonik
        gain2.gain.value = 0.05;

        globalMusicGain.gain.value = 0; // baÅŸta sessiz

        osc1.connect(gain1).connect(globalMusicGain).connect(ctx.destination);
        osc2.connect(gain2).connect(globalMusicGain).connect(ctx.destination);

        osc1.start();
        osc2.start();
    }
}

/* =============== PATLAMA SESÄ° (WHITE NOISE) =============== */
function playExplosionSound() {
    if (!soundEnabled || !ctx) return;

    const bufferSize = ctx.sampleRate * 0.4;
    const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
    const output = noiseBuffer.getChannelData(0);

    for (let i = 0; i < bufferSize; i++) {
        output[i] = Math.random() * 2 - 1;
    }

    const noise = ctx.createBufferSource();
    noise.buffer = noiseBuffer;

    const gainNode = ctx.createGain();
    gainNode.gain.setValueAtTime(1, ctx.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);

    noise.connect(gainNode).connect(ctx.destination);
    noise.start();
}

/* =============== ANÄ°MASYON DÃ–NGÃœSÃœ =============== */
function animate() {
    requestAnimationFrame(animate);
    c.clearRect(0, 0, canvas.width, canvas.height);

    // --- KAR ---
    for (let s of snowflakes) {
        c.beginPath();
        c.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        c.fillStyle = "white";
        c.fill();
        s.y += s.s;
        if (s.y > canvas.height) {
            s.y = -5;
            s.x = Math.random() * canvas.width;
        }
    }

    // --- FÄ°ÅžEK ---
    fireworks.forEach(f => {
        if (!f.exploded) {
            f.y -= 7;

            c.beginPath();
            c.fillStyle = "yellow";
            c.arc(f.x, f.y, 4, 0, Math.PI * 2);
            c.fill();

            if (f.y <= f.ty) {
                f.exploded = true;
                playExplosionSound();

                for (let i = 0; i < 35; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = Math.random() * 4 + 2;

                    f.particles.push({
                        x: f.x,
                        y: f.y,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed,
                        alpha: 1
                    });
                }
            }

        } else {
            f.particles.forEach(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.alpha -= 0.02;

                c.fillStyle = `rgba(255,150,50,${p.alpha})`;
                c.beginPath();
                c.arc(p.x, p.y, 3, 0, Math.PI * 2);
                c.fill();
            });
        }
    });

    fireworks = fireworks.filter(f => f.particles.length === 0 || f.particles.some(p => p.alpha > 0));
}
animate();

/* =============== BUTONLAR =============== */
document.getElementById("soundBtn").onclick = () => {
    initAudio();
    soundEnabled = !soundEnabled;
    if (soundEnabled) {
        globalMusicGain.gain.setValueAtTime(0.15, ctx.currentTime);
        document.getElementById("soundBtn").innerText = "ðŸ”Š Ses AÃ§Ä±k";
    } else {
        globalMusicGain.gain.setValueAtTime(0, ctx.currentTime);
        document.getElementById("soundBtn").innerText = "ðŸ”‡ Ses KapalÄ±";
    }
};

document.getElementById("startBtn").onclick = () => {
    initAudio();
    setInterval(spawnFirework, 600);
};
</script>
</body>
</html>
