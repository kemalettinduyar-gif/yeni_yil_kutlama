<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mutlu YÄ±llar 2026 â€” Emlak Grubu</title>

  <!-- GÃ–RÃœNMEYEN VERSÄ°YON KONTROLÃœ (DOM hazÄ±r olduktan sonra kÄ±sa gecikmeyle) -->
  <script>
  (function(){
    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(() => {
        try {
          const KEY = "page_v_final";
          const url = new URL(window.location.href);
          const v = url.searchParams.get("v");
          const saved = sessionStorage.getItem(KEY);
          if (!v || v !== saved) {
            const newV = Date.now().toString();
            sessionStorage.setItem(KEY, newV);
            const clean = window.location.origin + window.location.pathname;
            // href ile yÃ¶nlendir: sadece farklÄ±ysa yÃ¶nlendirir (dÃ¶ngÃ¼ yaratmaz)
            window.location.href = clean + "?v=" + newV;
          }
        } catch (e) {
          // sessizce devam et
          console.warn("version check failed", e);
        }
      }, 500); // 500ms: efektlerin kurulmasÄ± iÃ§in gÃ¼venli bekleme
    });
  })();
  </script>

  <style>
    html,body{
      height:100%;
      margin:0;
      background:radial-gradient(ellipse at bottom,#0f1720 0%,#020307 80%);
      font-family:Arial,Helvetica,sans-serif;
      color:#fff;
      overflow:hidden;
    }

    /* Canvases */
    #snowCanvas,#fireworksCanvas{
      position:fixed;
      left:0; top:0;
      width:100vw; height:100vh;
      pointer-events:none;
      z-index:10;
    }

    /* BaÅŸlÄ±k */
    .title-wrap{
      position:fixed;
      top:28px;
      width:100%;
      text-align:center;
      z-index:50;
      pointer-events:none;
    }
    h1{color:#ffd24c;margin:0;font-size:2.1rem;text-shadow:0 0 12px #000}
    h2{margin:6px 0 0;color:#fff;opacity:.9;font-size:1rem;letter-spacing:1.5px}

    /* Panel (butonlar) - footer ile Ã§akÄ±ÅŸmasÄ±n diye yukarÄ±da */
    .panel{
      position:fixed;
      bottom:110px;
      left:50%;
      transform:translateX(-50%);
      display:flex;
      gap:10px;
      z-index:60;
    }
    .panel button{
      padding:10px 16px;
      border-radius:10px;
      border:none;
      cursor:pointer;
      background:rgba(255,255,255,0.12);
      color:#fff;
      backdrop-filter:blur(4px);
      border:1px solid rgba(255,255,255,0.14);
      font-size:15px;
    }

    /* Footer en altta tek satÄ±r halinde */
    .footer{
      position:fixed;
      bottom:18px;
      left:50%;
      transform:translateX(-50%);
      background:rgba(0,0,0,0.45);
      padding:8px 14px;
      border-radius:8px;
      font-size:14px;
      z-index:60;
      white-space:nowrap;
    }

    @media (max-width:480px){
      .panel{ bottom:140px; }
      h1{font-size:1.6rem}
    }
  </style>
</head>
<body>

  <div class="title-wrap">
    <h1>Mutlu YÄ±llar 2026 ðŸŽ†</h1>
    <h2>MUTLU YILLAR EMLAK GRUBU</h2>
  </div>

  <canvas id="snowCanvas"></canvas>
  <canvas id="fireworksCanvas"></canvas>

  <div class="panel" aria-hidden="false">
    <button id="soundBtn">ðŸ”‡ Ses KapalÄ±</button>
    <button id="startBtn">ðŸŽ† KutlamayÄ± BaÅŸlat</button>
  </div>

  <div class="footer">Bu sayfa: Kemalettin Duyar tarafÄ±ndan hazÄ±rlanmÄ±ÅŸtÄ±r.</div>

  <!-- GÃ¼venilir, CORS/MIME uyumlu ses kaynaklarÄ± (HTTPS) -->
  <audio id="bgMusic" loop preload="auto"
    src="https://files.freemusicarchive.org/storage-freemusicarchive-org/music/no_curator/Scott_Holmes_Music/Happy_Music/Scott_Holmes_Music_-_Happy_Music.mp3"></audio>

  <audio id="launchSnd" preload="auto"
    src="https://actions.google.com/sounds/v1/impacts/medium_impact.ogg"></audio>

  <audio id="explodeSnd" preload="auto"
    src="https://actions.google.com/sounds/v1/fireworks/fireworks_whistle_bang.ogg"></audio>

<script>
/* =====================================================
   Canvas boyutlandÄ±rma + util
===================================================== */
const snowCanvas = document.getElementById("snowCanvas");
const snowCtx = snowCanvas.getContext("2d");
const fwCanvas = document.getElementById("fireworksCanvas");
const fwCtx = fwCanvas.getContext("2d");

function resizeAll(){
  snowCanvas.width = window.innerWidth;
  snowCanvas.height = window.innerHeight;
  fwCanvas.width = window.innerWidth;
  fwCanvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeAll);
resizeAll();

/* =====================================================
   KAR YAÄžIÅžI (requestAnimationFrame ile dÃ¼zgÃ¼n)
===================================================== */
let flakes = [];
function initFlakes(count = 260){
  flakes = [];
  for(let i=0;i<count;i++){
    flakes.push({
      x: Math.random() * window.innerWidth,
      y: Math.random() * window.innerHeight,
      r: 1 + Math.random()*4,
      vx: (Math.random()-0.5)*0.6,
      vy: 1 + Math.random()*2
    });
  }
}
initFlakes();

function drawSnow(){
  snowCtx.clearRect(0,0,snowCanvas.width,snowCanvas.height);
  snowCtx.fillStyle = "rgba(255,255,255,0.95)";
  snowCtx.beginPath();
  for(const f of flakes){
    snowCtx.moveTo(f.x, f.y);
    snowCtx.arc(f.x, f.y, f.r, 0, Math.PI*2);
  }
  snowCtx.fill();

  for(const f of flakes){
    f.x += f.vx + Math.sin(f.y/60) * 0.35;
    f.y += f.vy;
    if(f.y > window.innerHeight + 10){
      f.y = -10;
      f.x = Math.random() * window.innerWidth;
    }
    if(f.x < -20) f.x = window.innerWidth + 20;
    if(f.x > window.innerWidth + 20) f.x = -20;
  }
  requestAnimationFrame(drawSnow);
}
requestAnimationFrame(drawSnow);

/* =====================================================
   HAVAÄ° FÄ°ÅžEKLER (rokets -> parÃ§acÄ±klar)
===================================================== */
let rockets = [];
let particles = [];
let autoLaunchId = null;

function launchRocket(){
  rockets.push({
    x: Math.random() * fwCanvas.width,
    y: fwCanvas.height + 20,
    targetY: 80 + Math.random() * (fwCanvas.height * 0.45),
    speed: 6 + Math.random() * 3
  });

  // fÄ±rlatma sesi anlÄ±k (kÄ±sa)
  try { launchSnd.currentTime = 0; launchSnd.play().catch(()=>{}); } catch(e){}
}

function explode(x,y){
  const colors = ["#ff4d4d","#ffd11a","#66ff66","#66b3ff","#ff66cc","#ffffff"];
  const count = 45 + Math.floor(Math.random()*40);
  for(let i=0;i<count;i++){
    const ang = Math.random() * Math.PI * 2;
    const speed = 1.5 + Math.random() * 4.5;
    particles.push({
      x, y,
      vx: Math.cos(ang) * speed,
      vy: Math.sin(ang) * speed,
      age: 0,
      life: 60 + Math.random()*50,
      color: colors[Math.floor(Math.random()*colors.length)]
    });
  }

  // patlama sesi
  try { explodeSnd.currentTime = 0; explodeSnd.play().catch(()=>{}); } catch(e){}
}

function drawFW(){
  fwCtx.clearRect(0,0,fwCanvas.width,fwCanvas.height);

  // draw rockets
  for(let i = rockets.length-1; i>=0; i--){
    const r = rockets[i];
    r.y -= r.speed;
    fwCtx.fillStyle = "#fff";
    fwCtx.fillRect(r.x, r.y, 3, 8);

    if(r.y <= r.targetY){
      explode(r.x, r.y);
      rockets.splice(i,1);
    }
  }

  // draw particles
  for(let i = particles.length-1; i>=0; i--){
    const p = particles[i];
    p.vy += 0.03; // gravity
    p.x += p.vx;
    p.y += p.vy;
    p.age++;

    const alpha = Math.max(0, 1 - p.age / p.life);
    fwCtx.fillStyle = hexToRgba(p.color, alpha);
    fwCtx.fillRect(p.x, p.y, 2, 2);

    if(p.age >= p.life){
      particles.splice(i,1);
    }
  }

  requestAnimationFrame(drawFW);
}
requestAnimationFrame(drawFW);

function hexToRgba(hex, a){
  const c = hex.replace("#", "");
  const r = parseInt(c.substr(0,2),16);
  const g = parseInt(c.substr(2,2),16);
  const b = parseInt(c.substr(4,2),16);
  return `rgba(${r},${g},${b},${a})`;
}

/* =====================================================
   SES KONTROL (Autoplay politikasÄ±yla %100 uyumlu)
   - GÃ¼venilir HTTPS kaynaklarÄ± kullanÄ±ldÄ±
   - Ä°lk kullanÄ±cÄ± etkileÅŸimiyle "unlock" yapÄ±lÄ±r
   - Butonlar iÃ§inde play() Ã§aÄŸrÄ±larÄ± kesin kullanÄ±cÄ±-gesture kabul edilir
===================================================== */
const bgMusic = document.getElementById("bgMusic");
const launchSnd = document.getElementById("launchSnd");
const explodeSnd = document.getElementById("explodeSnd");

let soundEnabled = false;
let audioCtx = null; // gerektiÄŸinde kullanÄ±labilir

// Ä°lk etkileÅŸimde tarayÄ±cÄ±yÄ± "unlock" etmek iÃ§in: hem audio tagleri, hem AudioContext (opsiyonel)
function unlockAudioIfNeeded() {
  // try play/pause each audio (in user gesture) to unlock
  [bgMusic, launchSnd, explodeSnd].forEach(a => {
    try {
      a.currentTime = 0;
      const p = a.play();
      if (p && typeof p.then === "function") {
        p.then(() => {
          a.pause();
          a.currentTime = 0;
        }).catch(()=>{ /* ignore */ });
      }
    } catch(e){}
  });

  // create a short AudioContext sound as extra unlock (some mobiles)
  try {
    if (!audioCtx) {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = "sine";
      osc.frequency.value = 220;
      gain.gain.value = 0.0001; // inaudible but unlocks context
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.start(0);
      setTimeout(()=>{ try{ osc.stop(); }catch(e){} }, 50);
    }
  } catch(e){}
}

// toggle sound (called from soundBtn click â€” direct user gesture)
function toggleSound() {
  soundEnabled = !soundEnabled;
  const btn = document.getElementById("soundBtn");
  btn.innerText = soundEnabled ? "ðŸ”Š Ses AÃ§Ä±k" : "ðŸ”‡ Ses KapalÄ±";

  // unlock now (inside gesture)
  unlockAudioIfNeeded();

  if (soundEnabled) {
    try { bgMusic.currentTime = 0; bgMusic.play().catch(()=>{}); } catch(e){}
  } else {
    try { bgMusic.pause(); } catch(e){}
  }
}

// also unlock on first pointerdown anywhere to be safe
window.addEventListener("pointerdown", function firstUnlock(){
  unlockAudioIfNeeded();
  window.removeEventListener("pointerdown", firstUnlock);
}, { once:true, passive: true });

/* =====================================================
   Buton eventleri
===================================================== */
document.getElementById("soundBtn").addEventListener("click", toggleSound);

document.getElementById("startBtn").addEventListener("click", function(){
  // start is a user gesture: ensure unlock and then start fireworks and sounds
  unlockAudioIfNeeded();

  if (soundEnabled) {
    try { launchSnd.currentTime = 0; launchSnd.play().catch(()=>{}); } catch(e){}
  }

  // start auto-launch if not already started
  if (!autoLaunchId) autoLaunchId = setInterval(launchRocket, 650);

  // send a few immediate rockets for fast feedback
  launchRocket(); launchRocket();
});

/* =====================================================
   Debug helper (optional) - uncomment to test quickly
===================================================== */
// // quick test button (if you want): create, append to body
// const testBtn = document.createElement('button');
// testBtn.textContent = "TEST SES (hareket sonrasÄ±)";
// testBtn.style.position='fixed'; testBtn.style.right='10px'; testBtn.style.top='10px'; testBtn.style.zIndex=9999;
// testBtn.onclick = ()=> { unlockAudioIfNeeded(); bgMusic.play().catch(()=>{}); launchSnd.play().catch(()=>{}); explodeSnd.play().catch(()=>{}); };
// document.body.appendChild(testBtn);

</script>
</body>
</html>
