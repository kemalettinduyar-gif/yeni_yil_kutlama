<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mutlu YÄ±llar 2026 â€” Emlak Grubu</title>

  <style>
    html,body{height:100%;margin:0;background:radial-gradient(ellipse at bottom,#0f1720 0%,#020307 80%);font-family:Arial,sans-serif;color:#fff;overflow:hidden}
    #snowCanvas,#fireworksCanvas{position:fixed;left:0;top:0;width:100vw;height:100vh;pointer-events:none}
    .panel{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);display:flex;gap:10px;z-index:40}
    button{padding:10px 16px;border-radius:10px;border:none;cursor:pointer;background:#ffffff18;color:#fff;backdrop-filter:blur(4px);border:1px solid #ffffff22}
    #versionBox{position:fixed;top:10px;right:10px;background:#00000066;padding:6px 10px;border-radius:6px;font-size:13px;z-index:50}
    .title-wrap{position:fixed;top:40px;width:100%;text-align:center;z-index:30}
    h1{color:#ffd24c;margin:0;text-shadow:0 0 12px #000;font-size:2.2rem}
    h2{margin:6px 0 0;color:#fff;opacity:.9;font-size:1rem;letter-spacing:1.5px}
  </style>
</head>
<body>

<!-- VERSION KONTROLÃœ (GÃœVENLÄ°) -->
<script>
  // Versiyon kontrolÃ¼: DOMContentLoaded sonrasÄ±, kÄ±sa gecikmeyle yÃ¶nlendirir.
  // BÃ¶ylece diÄŸer script'ler DOM hazÄ±r olmadan kesintiye uÄŸramaz.
  (function(){
    document.addEventListener("DOMContentLoaded", () => {
      // KÃ¼Ã§Ã¼k gecikme: tÃ¼m gÃ¶rseller ve ses elementleri oluÅŸturulsun.
      setTimeout(() => {
        try {
          const key = "site_version_final";
          const sessionVer = sessionStorage.getItem(key);
          const currentParams = new URL(location.href).searchParams;
          const urlVer = currentParams.get("v");

          // EÄŸer URL'de 'v' parametresi yoksa veya sessiondaki veriden farklÄ±ysa -> yenile
          if (!urlVer || sessionVer !== urlVer) {
            const newVer = Date.now().toString();
            sessionStorage.setItem(key, newVer);

            // Temiz URL (aynÄ± dosya) + v parametresi
            const clean = window.location.origin + window.location.pathname;
            // replace yerine href kullanÄ±yoruz ki tarayÄ±cÄ± sayfayÄ± kesin yÃ¼klesin
            // fakat sadece farklÄ±ysa yÃ¶nlendirme olur, dÃ¶ngÃ¼ yaratÄ±lmaz.
            window.location.href = clean + "?v=" + newVer;
          }
        } catch (e) {
          // EÄŸer herhangi bir hata olursa, sessizce devam et (uyumluluk iÃ§in).
          console.warn("Versiyon kontrol hatasÄ±", e);
        }
      }, 200); // 200ms: yeterli ve gÃ¼venli
    });
  })();
</script>

<!-- BaÅŸlÄ±k -->
<div class="title-wrap">
  <h1>Mutlu YÄ±llar 2026 ðŸŽ†</h1>
  <h2>MUTLU YILLAR EMLAK GRUBU</h2>
</div>

<!-- CANVAS'lar -->
<canvas id="snowCanvas"></canvas>
<canvas id="fireworksCanvas"></canvas>

<!-- Kontroller -->
<div id="versionBox">Versiyon: <span id="verText">â€”</span></div>

<div class="panel">
  <button id="soundBtn">ðŸ”‡ Ses KapalÄ±</button>
  <button id="startBtn">ðŸŽ† KutlamayÄ± BaÅŸlat</button>
</div>

<!-- Ses (Ã¶nceden yÃ¼kleniyor) -->
<audio id="bgMusic" loop preload="auto" src="https://cdn.pixabay.com/download/audio/2022/03/01/audio_11ac392cda.mp3?filename=new-year-party-10980.mp3"></audio>
<audio id="launchSnd" preload="auto" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_63aebaa9d8.mp3?filename=launch-rocket-113177.mp3"></audio>
<audio id="explodeSnd" preload="auto" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_49709c8a31.mp3?filename=firework-1-113172.mp3"></audio>

<script>
/* ---------- VERSÄ°YON GÃ–STER ---------- */
(function(){
  // EÄŸer URL'de v param varsa onu gÃ¶ster, yoksa "yeni" yaz
  try {
    const params = new URL(location.href).searchParams;
    const v = params.get("v") || "yeni";
    document.getElementById("verText").innerText = v;
  } catch(e){ document.getElementById("verText").innerText = "â€”"; }
})();

/* ---------- CANVAS BOYUTLANDIRMA ---------- */
const snowCanvas = document.getElementById("snowCanvas");
const snowCtx = snowCanvas.getContext("2d");
const fwCanvas = document.getElementById("fireworksCanvas");
const fwCtx = fwCanvas.getContext("2d");

function resizeAll() {
  const w = window.innerWidth;
  const h = window.innerHeight;
  snowCanvas.width = w; snowCanvas.height = h;
  fwCanvas.width = w; fwCanvas.height = h;
}
window.addEventListener("resize", resizeAll);
resizeAll();

/* ---------- KAR YAÄžIÅžI (tam ekran, her taneler iniyor) ---------- */
let flakes = [];
function initFlakes(count = 220){
  flakes = [];
  for(let i=0;i<count;i++){
    flakes.push({
      x: Math.random()*window.innerWidth,
      y: Math.random()*window.innerHeight,
      r: 1 + Math.random()*5,
      vx: (Math.random()-0.5)*0.5,
      vy: 1 + Math.random()*2
    });
  }
}
initFlakes();

function drawSnow(){
  snowCtx.clearRect(0,0,snowCanvas.width,snowCanvas.height);
  snowCtx.fillStyle = "rgba(255,255,255,0.9)";
  snowCtx.beginPath();
  for(const f of flakes){
    snowCtx.moveTo(f.x,f.y);
    snowCtx.arc(f.x,f.y,f.r,0,Math.PI*2);
  }
  snowCtx.fill();

  // update
  for(const f of flakes){
    f.x += f.vx;
    f.y += f.vy;
    // hafif salÄ±nÄ±m
    f.x += Math.sin((f.y/50) + f.r) * 0.3;
    if(f.y > window.innerHeight + 10){
      f.y = -10 - Math.random()*100; // yukarÄ±dan yeniden baÅŸlat
      f.x = Math.random()*window.innerWidth;
    }
    if(f.x < -10) f.x = window.innerWidth + 10;
    if(f.x > window.innerWidth + 10) f.x = -10;
  }
}
setInterval(drawSnow, 30); // ~33fps

/* ---------- HAVAÄ° FÄ°ÅžEK (sÃ¼rekli, Ã§oklu patlama) ---------- */
let rockets = [];
let particles = [];

function launchRocket(){
  rockets.push({
    x: Math.random()*fwCanvas.width,
    y: fwCanvas.height + 10,
    targetY: 60 + Math.random()* (fwCanvas.height*0.5),
    speed: 6 + Math.random()*3
  });
}

function explode(x,y){
  const colors = ["#ff4d4d","#ffd11a","#66ff66","#66b3ff","#ff66cc","#ffffff"];
  const count = 40 + Math.floor(Math.random()*30);
  for(let i=0;i<count;i++){
    const angle = Math.random()*Math.PI*2;
    const speed = 1.5 + Math.random()*4;
    particles.push({
      x,y,
      vx: Math.cos(angle)*speed,
      vy: Math.sin(angle)*speed,
      life: 50 + Math.random()*40,
      age:0,
      color: colors[Math.floor(Math.random()*colors.length)]
    });
  }
}

function drawFW(){
  fwCtx.clearRect(0,0,fwCanvas.width,fwCanvas.height);

  // rockets
  for(let i=rockets.length-1;i>=0;i--){
    const r = rockets[i];
    r.y -= r.speed;
    fwCtx.fillStyle = "#fff";
    fwCtx.fillRect(r.x, r.y, 3, 8);

    if(r.y <= r.targetY){
      // patlama
      explode(r.x, r.y);
      rockets.splice(i,1);
      // ses
      if(soundEnabled){
        try { explodeSnd.currentTime = 0; explodeSnd.play().catch(()=>{}); } catch(e){}
      }
    }
  }

  // particles
  for(let i=particles.length-1;i>=0;i--){
    const p = particles[i];
    // physics
    p.vy += 0.03; // yerÃ§ekimi hafif
    p.x += p.vx;
    p.y += p.vy;
    p.age += 1;

    const alpha = Math.max(0, 1 - p.age / p.life);
    fwCtx.fillStyle = hexToRgba(p.color, alpha);
    fwCtx.fillRect(p.x, p.y, 2, 2);

    if(p.age >= p.life) particles.splice(i,1);
  }

  requestAnimationFrame(drawFW);
}
drawFW();

function hexToRgba(hex, a){
  const c = hex.replace("#","");
  const r = parseInt(c.substr(0,2),16);
  const g = parseInt(c.substr(2,2),16);
  const b = parseInt(c.substr(4,2),16);
  return `rgba(${r},${g},${b},${a})`;
}

/* ---------- BaÅŸlatma: butona basÄ±ldÄ±ÄŸÄ±nda 10 saniye boyunca her 600ms ateÅŸle ---------- */
let celebrationInterval = null;
function startCelebration(){
  if(celebrationInterval) return;
  // ilk anda birkaÃ§ roket gÃ¶nder
  launchRocket(); launchRocket(); launchRocket();
  celebrationInterval = setInterval(launchRocket, 600);
  // otomatik durdurmak istersen Ã¶rn 20 saniye sonra: aÅŸaÄŸÄ±daki satÄ±rÄ± aÃ§
  // setTimeout(()=>{ clearInterval(celebrationInterval); celebrationInterval=null; },20000);
}

/* ---------- SES KONTROLÃœ (tek global audio nesneleri) ---------- */
const bgMusic = document.getElementById("bgMusic");
const launchSnd = document.getElementById("launchSnd");
const explodeSnd = document.getElementById("explodeSnd");

let soundEnabled = false;
const soundBtn = document.getElementById("soundBtn");

function preloadSounds(){
  // KullanÄ±cÄ± etkileÅŸimiyle Ã§aÄŸrÄ±lmasÄ± gerekiyor; burada sadece hazÄ±r etme denemesi
  try{
    bgMusic.load(); launchSnd.load(); explodeSnd.load();
  }catch(e){}
}

function toggleSound(){
  soundEnabled = !soundEnabled;
  soundBtn.innerText = soundEnabled ? "ðŸ”Š Ses AÃ§Ä±k" : "ðŸ”‡ Ses KapalÄ±";
  if(soundEnabled){
    // mobil tarayÄ±cÄ±larÄ±n user gesture politikasÄ±: play() yalnÄ±zca bir kullanÄ±cÄ± etkileÅŸimiyle baÅŸarÄ±labilir
    bgMusic.currentTime = 0;
    bgMusic.play().catch(()=>{});
    try{ launchSnd.currentTime = 0; }catch(e){}
  } else {
    try{ bgMusic.pause(); }catch(e){}
  }
}

/* ---------- Buton event baÄŸlama (gÃ¼venli) ---------- */
document.getElementById("startBtn").addEventListener("click", function(){
  // ilk tÄ±klama kullanÄ±cÄ± etkileÅŸimi olduÄŸu iÃ§in ses izinleri aÃ§Ä±labilir
  preloadSounds();
  // ufak bir deneme sesleri (kullanÄ±cÄ± etkileÅŸimi iÃ§inde)
  if(soundEnabled){
    try{ launchSnd.currentTime = 0; launchSnd.play().catch(()=>{}); }catch(e){}
  }
  startCelebration();
});
soundBtn.addEventListener("click", function(){ toggleSound(); });

/* ---------- Ä°lk otomatik kÃ¼Ã§Ã¼k roketler (gÃ¶rsel zenginlik) ---------- */
setTimeout(()=>{ launchRocket(); }, 800);
setTimeout(()=>{ launchRocket(); }, 1500);

</script>

</body>
</html>
