<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mutlu YÄ±llar 2026 â€” Emlak Grubu</title>

  <!-- GÄ°ZLÄ° VERSÄ°YON KONTROLÃœ (gÃ¶rÃ¼nmez, DOM hazÄ±r sonrasÄ± kÄ±sa gecikme) -->
  <script>
  (function(){
    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(() => {
        try {
          const KEY = "page_v_final";
          const url = new URL(window.location.href);
          const v = url.searchParams.get("v");
          const saved = sessionStorage.getItem(KEY);
          if (!v || v !== saved) {
            const newV = Date.now().toString();
            sessionStorage.setItem(KEY, newV);
            const clean = window.location.origin + window.location.pathname;
            window.location.href = clean + "?v=" + newV;
          }
        } catch(e){/* silent */ }
      }, 400);
    });
  })();
  </script>

  <style>
    html,body{
      height:100%;
      margin:0;
      background: radial-gradient(ellipse at bottom, #0f1720 0%, #020307 80%);
      font-family: Arial, Helvetica, sans-serif;
      color: #fff;
      overflow: hidden;
    }

    #snowCanvas,#fireworksCanvas{
      position: fixed;
      left:0; top:0;
      width:100vw; height:100vh;
      pointer-events: none;
      z-index: 10;
    }

    .title-wrap{
      position: fixed; top:28px; width:100%; text-align:center; z-index:60; pointer-events: none;
    }
    h1{ color:#ffd24c; margin:0; font-size:2.1rem; text-shadow:0 0 12px #000; }
    h2{ margin:6px 0 0; font-size:1rem; opacity:.95; letter-spacing:1.2px; }

    .panel{
      position: fixed;
      bottom: 110px;
      left: 50%;
      transform: translateX(-50%);
      display:flex;
      gap:10px;
      z-index:70;
    }
    .panel button{
      padding:10px 16px;
      border-radius:10px;
      border:none;
      cursor:pointer;
      background: rgba(255,255,255,0.12);
      color:#fff;
      backdrop-filter: blur(4px);
      border:1px solid rgba(255,255,255,0.14);
      font-size:15px;
    }

    .footer{
      position: fixed;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.45);
      padding: 8px 14px;
      border-radius: 8px;
      font-size:14px;
      z-index:70;
      white-space: nowrap;
    }

    @media (max-width:480px){
      .panel{ bottom:140px; flex-direction:column; }
      .panel button{ width:160px; }
      h1{ font-size:1.6rem; }
    }
  </style>
</head>
<body>

  <div class="title-wrap">
    <h1>Mutlu YÄ±llar 2026 ðŸŽ†</h1>
    <h2>MUTLU YILLAR EMLAK GRUBU</h2>
  </div>

  <canvas id="snowCanvas"></canvas>
  <canvas id="fireworksCanvas"></canvas>

  <div class="panel" role="region" aria-label="Kontroller">
    <button id="soundBtn" aria-pressed="false">ðŸ”‡ Ses KapalÄ±</button>
    <button id="startBtn">ðŸŽ† KutlamayÄ± BaÅŸlat</button>
  </div>

  <div class="footer">Bu sayfa: Kemalettin Duyar tarafÄ±ndan hazÄ±rlanmÄ±ÅŸtÄ±r.</div>

<script>
/* -------------------- Canvas setup -------------------- */
const snowCanvas = document.getElementById('snowCanvas');
const snowCtx = snowCanvas.getContext('2d');
const fwCanvas = document.getElementById('fireworksCanvas');
const fwCtx = fwCanvas.getContext('2d');

function resizeAll(){
  snowCanvas.width = window.innerWidth;
  snowCanvas.height = window.innerHeight;
  fwCanvas.width = window.innerWidth;
  fwCanvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeAll);
resizeAll();

/* -------------------- Snow -------------------- */
let flakes = [];
function initFlakes(n=260){
  flakes = [];
  for(let i=0;i<n;i++){
    flakes.push({
      x: Math.random()*window.innerWidth,
      y: Math.random()*window.innerHeight,
      r: 1 + Math.random()*4,
      vx: (Math.random()-0.5)*0.6,
      vy: 1 + Math.random()*2
    });
  }
}
initFlakes();

function drawSnow(){
  snowCtx.clearRect(0,0,snowCanvas.width,snowCanvas.height);
  snowCtx.fillStyle = "rgba(255,255,255,0.95)";
  snowCtx.beginPath();
  for(const f of flakes){
    snowCtx.moveTo(f.x,f.y);
    snowCtx.arc(f.x,f.y,f.r,0,Math.PI*2);
  }
  snowCtx.fill();
  for(const f of flakes){
    f.x += f.vx + Math.sin(f.y/60)*0.35;
    f.y += f.vy;
    if(f.y > window.innerHeight+10){
      f.y = -10; f.x = Math.random()*window.innerWidth;
    }
    if(f.x < -20) f.x = window.innerWidth + 20;
    if(f.x > window.innerWidth + 20) f.x = -20;
  }
  requestAnimationFrame(drawSnow);
}
requestAnimationFrame(drawSnow);

/* -------------------- Fireworks -------------------- */
let rockets = [], particles = [], autoLaunch = null;

function launchRocket(){
  const r = {
    x: Math.random()*fwCanvas.width,
    y: fwCanvas.height + 10,
    targetY: 60 + Math.random()*(fwCanvas.height*0.45),
    speed: 6 + Math.random()*3
  };
  rockets.push(r);
  // NOTE: launch sound removed (per request)
}

function explode(x,y){
  const colors = ["#ff4d4d","#ffd11a","#66ff66","#66b3ff","#ff66cc","#ffffff"];
  const count = 45 + Math.floor(Math.random()*40);
  for(let i=0;i<count;i++){
    const ang = Math.random()*Math.PI*2;
    const speed = 1.5 + Math.random()*4.5;
    particles.push({
      x, y,
      vx: Math.cos(ang)*speed,
      vy: Math.sin(ang)*speed,
      age: 0,
      life: 60 + Math.random()*50,
      color: colors[Math.floor(Math.random()*colors.length)]
    });
  }

  // explosion sound (kept)
  if(soundEnabled) playExplosionSound();
}

function drawFW(){
  fwCtx.clearRect(0,0,fwCanvas.width,fwCanvas.height);

  for(let i=rockets.length-1;i>=0;i--){
    const r = rockets[i];
    r.y -= r.speed;
    fwCtx.fillStyle = "#fff";
    fwCtx.fillRect(r.x, r.y, 3, 8);

    if(r.y <= r.targetY){
      explode(r.x, r.y);
      rockets.splice(i,1);
    }
  }

  for(let i=particles.length-1;i>=0;i--){
    const p = particles[i];
    p.vy += 0.03;
    p.x += p.vx;
    p.y += p.vy;
    p.age++;
    const a = Math.max(0, 1 - p.age / p.life);
    fwCtx.fillStyle = hexToRgba(p.color, a);
    fwCtx.fillRect(p.x, p.y, 2, 2);
    if(p.age >= p.life) particles.splice(i,1);
  }

  requestAnimationFrame(drawFW);
}
requestAnimationFrame(drawFW);

function hexToRgba(hex, a){
  const c = hex.replace('#','');
  const r = parseInt(c.substr(0,2),16);
  const g = parseInt(c.substr(2,2),16);
  const b = parseInt(c.substr(4,2),16);
  return `rgba(${r},${g},${b},${a})`;
}

/* -------------------- Web Audio (effects + ambient music) -------------------- */
let audioCtx = null;
let soundEnabled = false;
let bgGain = null;
let bgOsc1 = null;
let bgOsc2 = null;

function ensureAudioContext(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  } else {
    // resume if suspended
    if(audioCtx.state === 'suspended' && typeof audioCtx.resume === 'function'){
      audioCtx.resume().catch(()=>{});
    }
  }
}

/* ----- Explosion (noise) ----- */
function playExplosionSound(){
  try {
    ensureAudioContext();
    const ctx = audioCtx;
    const now = ctx.currentTime;

    // create noise buffer
    const bufferSize = Math.floor(ctx.sampleRate * 0.38); // ~0.38s
    const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
    const data = buffer.getChannelData(0);
    for(let i=0;i<bufferSize;i++){
      // decaying noise
      data[i] = (Math.random()*2-1) * Math.pow(1 - i/bufferSize, 3);
    }

    const noise = ctx.createBufferSource();
    noise.buffer = buffer;

    const bandpass = ctx.createBiquadFilter();
    bandpass.type = 'bandpass';
    bandpass.frequency.value = 1400 + Math.random()*600;
    bandpass.Q.value = 0.8;

    const gain = ctx.createGain();
    gain.gain.setValueAtTime(0.7, now);
    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.45);

    // low rumble for body
    const rumble = ctx.createOscillator();
    rumble.type = 'sine';
    rumble.frequency.value = 70 + Math.random()*30;
    const rumbleGain = ctx.createGain();
    rumbleGain.gain.setValueAtTime(0.35, now);
    rumbleGain.gain.exponentialRampToValueAtTime(0.001, now + 0.45);

    noise.connect(bandpass);
    bandpass.connect(gain);
    gain.connect(ctx.destination);

    rumble.connect(rumbleGain);
    rumbleGain.connect(ctx.destination);

    noise.start(now);
    noise.stop(now + 0.45);

    rumble.start(now);
    rumble.stop(now + 0.45);
  } catch(e){ console.warn('explosion sound error', e); }
}

/* -------------------- Background ambient "holiday" music (Web Audio) -------------------- */
let bgStarted = false;
function startBackgroundMusic(){
  if(bgStarted) return;
  bgStarted = true;

  ensureAudioContext();
  const ctx = audioCtx;

  // master gain
  bgGain = ctx.createGain();
  bgGain.gain.value = 0; // start muted, toggled by button
  bgGain.connect(ctx.destination);

  // two oscillators for gentle ambient
  bgOsc1 = ctx.createOscillator();
  bgOsc1.type = 'sine';
  bgOsc1.frequency.value = 220; // low base
  const g1 = ctx.createGain(); g1.gain.value = 0.08;

  bgOsc2 = ctx.createOscillator();
  bgOsc2.type = 'triangle';
  bgOsc2.frequency.value = 330; // harmonic
  const g2 = ctx.createGain(); g2.gain.value = 0.05;

  // slight slow detune/modulation for pleasantness
  const lfo = ctx.createOscillator();
  lfo.type = 'sine';
  lfo.frequency.value = 0.08; // very slow
  const lfoGain = ctx.createGain(); lfoGain.gain.value = 8; // detune amount in cents-ish

  // connect
  bgOsc1.connect(g1); g1.connect(bgGain);
  bgOsc2.connect(g2); g2.connect(bgGain);

  // apply subtle frequency modulation by LFO to osc2
  lfo.connect(bgOsc2.frequency);
  lfo.start();

  bgOsc1.start();
  bgOsc2.start();
}

/* toggle background music on/off (smooth ramp) */
function toggleBackgroundMusic(on){
  try{
    startBackgroundMusic();
    const ctx = audioCtx;
    const now = ctx.currentTime;
    if(on){
      bgGain.gain.cancelScheduledValues(now);
      bgGain.gain.setValueAtTime(bgGain.gain.value || 0, now);
      bgGain.gain.linearRampToValueAtTime(0.12, now + 0.6); // gentle fade-in
    } else {
      bgGain.gain.cancelScheduledValues(now);
      bgGain.gain.setValueAtTime(bgGain.gain.value || 0, now);
      bgGain.gain.linearRampToValueAtTime(0, now + 0.4); // fade-out
    }
  }catch(e){ console.warn('toggleBackgroundMusic error', e); }
}

/* unlock trick: tiny inaudible oscillator to unlock audio on gesture */
function unlockAudioIfNeeded(){
  try {
    ensureAudioContext();
    const ctx = audioCtx;
    // tiny silent oscillator
    const osc = ctx.createOscillator();
    const g = ctx.createGain();
    g.gain.value = 0.00001;
    osc.connect(g); g.connect(ctx.destination);
    osc.start();
    setTimeout(()=>{ try { osc.stop(); } catch(e){} }, 50);
  } catch(e){ /* ignore */ }
}

/* -------------------- Controls -------------------- */
const soundBtn = document.getElementById('soundBtn');
const startBtn = document.getElementById('startBtn');

soundBtn.addEventListener('click', () => {
  unlockAudioIfNeeded(); // inside gesture
  soundEnabled = !soundEnabled;
  soundBtn.innerText = soundEnabled ? 'ðŸ”Š Ses AÃ§Ä±k' : 'ðŸ”‡ Ses KapalÄ±';
  soundBtn.setAttribute('aria-pressed', String(soundEnabled));

  // toggle background music
  toggleBackgroundMusic(soundEnabled);
});

startBtn.addEventListener('click', () => {
  unlockAudioIfNeeded(); // inside gesture ensures ctx/resume allowed

  if(!autoLaunch){
    autoLaunch = setInterval(launchRocket, 650);
  }
  // immediate feedback: explode (if sound enabled)
  // launch couple rockets immediately for visual feedback
  launchRocket(); launchRocket();
});

/* also unlock on first pointerdown anywhere to be safe */
window.addEventListener('pointerdown', function firstUnlock(){
  unlockAudioIfNeeded();
  window.removeEventListener('pointerdown', firstUnlock);
}, { once:true, passive:true });

</script>
</body>
</html>
